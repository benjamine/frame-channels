!function(t){if("object"==typeof exports)module.exports=t();else if("function"==typeof define&&define.amd)define(t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.frameChannels=t()}}(function(){return function t(e,n,i){function o(s,a){if(!n[s]){if(!e[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(r)return r(s,!0);throw new Error("Cannot find module '"+s+"'")}var c=n[s]={exports:{}};e[s][0].call(c.exports,function(t){var n=e[s][1][t];return o(n?n:t)},c,c.exports,t,e,n,i)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<i.length;s++)o(i[s]);return o}({1:[function(t,e,n){"use strict";var i=t("./promise/promise").Promise,o=t("./promise/polyfill").polyfill;n.Promise=i,n.polyfill=o},{"./promise/polyfill":5,"./promise/promise":6}],2:[function(t,e,n){"use strict";function i(t){var e=this;if(!o(t))throw new TypeError("You must pass an array to all.");return new e(function(e,n){function i(t){return function(e){o(t,e)}}function o(t,n){a[t]=n,0===--u&&e(a)}var s,a=[],u=t.length;0===u&&e([]);for(var c=0;c<t.length;c++)s=t[c],s&&r(s.then)?s.then(i(c),n):o(c,s)})}var o=t("./utils").isArray,r=t("./utils").isFunction;n.all=i},{"./utils":10}],3:[function(t,e,n){(function(t,e){"use strict";function i(){return function(){t.nextTick(s)}}function o(){var t=0,e=new f(s),n=document.createTextNode("");return e.observe(n,{characterData:!0}),function(){n.data=t=++t%2}}function r(){return function(){l.setTimeout(s,1)}}function s(){for(var t=0;t<d.length;t++){var e=d[t],n=e[0],i=e[1];n(i)}d=[]}function a(t,e){var n=d.push([t,e]);1===n&&u()}var u,c="undefined"!=typeof window?window:{},f=c.MutationObserver||c.WebKitMutationObserver,l="undefined"!=typeof e?e:void 0===this?window:this,d=[];u="undefined"!=typeof t&&"[object process]"==={}.toString.call(t)?i():f?o():r(),n.asap=a}).call(this,t("1YiZ5S"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"1YiZ5S":11}],4:[function(t,e,n){"use strict";function i(t,e){return 2!==arguments.length?o[t]:void(o[t]=e)}var o={instrument:!1};n.config=o,n.configure=i},{}],5:[function(t,e,n){(function(e){"use strict";function i(){var t;t="undefined"!=typeof e?e:"undefined"!=typeof window&&window.document?window:self;var n="Promise"in t&&"resolve"in t.Promise&&"reject"in t.Promise&&"all"in t.Promise&&"race"in t.Promise&&function(){var e;return new t.Promise(function(t){e=t}),r(e)}();n||(t.Promise=o)}var o=t("./promise").Promise,r=t("./utils").isFunction;n.polyfill=i}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./promise":6,"./utils":10}],6:[function(t,e,n){"use strict";function i(t){if(!w(t))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof i))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._subscribers=[],o(t,this)}function o(t,e){function n(t){c(e,t)}function i(t){l(e,t)}try{t(n,i)}catch(o){i(o)}}function r(t,e,n,i){var o,r,s,a,f=w(n);if(f)try{o=n(i),s=!0}catch(d){a=!0,r=d}else o=i,s=!0;u(e,o)||(f&&s?c(e,o):a?l(e,r):t===E?c(e,o):t===T&&l(e,o))}function s(t,e,n,i){var o=t._subscribers,r=o.length;o[r]=e,o[r+E]=n,o[r+T]=i}function a(t,e){for(var n,i,o=t._subscribers,s=t._detail,a=0;a<o.length;a+=3)n=o[a],i=o[a+e],r(e,n,i,s);t._subscribers=null}function u(t,e){var n,i=null;try{if(t===e)throw new TypeError("A promises callback cannot return that same promise.");if(m(e)&&(i=e.then,w(i)))return i.call(e,function(i){return n?!0:(n=!0,void(e!==i?c(t,i):f(t,i)))},function(e){return n?!0:(n=!0,void l(t,e))}),!0}catch(o){return n?!0:(l(t,o),!0)}return!1}function c(t,e){t===e?f(t,e):u(t,e)||f(t,e)}function f(t,e){t._state===x&&(t._state=P,t._detail=e,p.async(d,t))}function l(t,e){t._state===x&&(t._state=P,t._detail=e,p.async(h,t))}function d(t){a(t,t._state=E)}function h(t){a(t,t._state=T)}var p=t("./config").config,m=(t("./config").configure,t("./utils").objectOrFunction),w=t("./utils").isFunction,y=(t("./utils").now,t("./all").all),v=t("./race").race,g=t("./resolve").resolve,b=t("./reject").reject,_=t("./asap").asap;p.async=_;var x=void 0,P=0,E=1,T=2;i.prototype={constructor:i,_state:void 0,_detail:void 0,_subscribers:void 0,then:function(t,e){var n=this,i=new this.constructor(function(){});if(this._state){var o=arguments;p.async(function(){r(n._state,i,o[n._state-1],n._detail)})}else s(this,i,t,e);return i},"catch":function(t){return this.then(null,t)}},i.all=y,i.race=v,i.resolve=g,i.reject=b,n.Promise=i},{"./all":2,"./asap":3,"./config":4,"./race":7,"./reject":8,"./resolve":9,"./utils":10}],7:[function(t,e,n){"use strict";function i(t){var e=this;if(!o(t))throw new TypeError("You must pass an array to race.");return new e(function(e,n){for(var i,o=0;o<t.length;o++)i=t[o],i&&"function"==typeof i.then?i.then(e,n):e(i)})}var o=t("./utils").isArray;n.race=i},{"./utils":10}],8:[function(t,e,n){"use strict";function i(t){var e=this;return new e(function(e,n){n(t)})}n.reject=i},{}],9:[function(t,e,n){"use strict";function i(t){if(t&&"object"==typeof t&&t.constructor===this)return t;var e=this;return new e(function(e){e(t)})}n.resolve=i},{}],10:[function(t,e,n){"use strict";function i(t){return o(t)||"object"==typeof t&&null!==t}function o(t){return"function"==typeof t}function r(t){return"[object Array]"===Object.prototype.toString.call(t)}var s=Date.now||function(){return(new Date).getTime()};n.objectOrFunction=i,n.isFunction=o,n.isArray=r,n.now=s},{}],11:[function(t,e){function n(){}var i=e.exports={};i.nextTick=function(){var t="undefined"!=typeof window&&window.setImmediate,e="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(t)return function(t){return window.setImmediate(t)};if(e){var n=[];return window.addEventListener("message",function(t){var e=t.source;if((e===window||null===e)&&"process-tick"===t.data&&(t.stopPropagation(),n.length>0)){var i=n.shift();i()}},!0),function(t){n.push(t),window.postMessage("process-tick","*")}}return function(t){setTimeout(t,0)}}(),i.title="browser",i.browser=!0,i.env={},i.argv=[],i.on=n,i.addListener=n,i.once=n,i.off=n,i.removeListener=n,i.removeAllListeners=n,i.emit=n,i.binding=function(){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(){throw new Error("process.chdir is not supported")}},{}],12:[function(t,e){function n(t){this.channel=t}var i=t("es6-promise").Promise;n.prototype.ready=function(){var t=this,e=this.readyPromise;if(!e){var n=this.channel,o=n.options.iframe;e=new i(function(e,i){var r=!1,s=!1,a=function(t){r||s||!t.ready&&!t.pong||(r=!0,n.unsubscribe(a),e())};n.subscribe(a);var u=t.element||document.getElementById(o.id);if(u){t.element=u;try{n.push({ping:!0,respond:!0})}catch(c){console.log("failed to ping frame channel")}}else{if(u=document.createElement("iframe"),t.element=u,u.id=o.id,u.style.display="none",o.allowPositionControl&&t.subscribeToPositionMessages(),document.body.appendChild(u),o.url)u.src=o.url;else if(o.html){var f=u.contentDocument||u.contentWindow.document;f.write(o.html.toString()),f.close()}"function"==typeof o.setup&&o.setup(u)}setTimeout(function(){r||(s=!0,console.error&&console.error("timeout waiting for frame channel"),n.unsubscribe(a),i(new Error("timeout waiting for frame channel")))},o.readyTimeout||15e3)}),this.readyPromise=e}return e},n.prototype.subscribeToPositionMessages=function(){var t=this;this.channel.subscribe(function(e,n){e.maximize&&t.maximize(),e.size&&t.size(e.size.width,e.size.height),e.restore&&t.restore(),e.dock&&t.dock(e.dock),e.show&&t.show(),e.hide&&t.hide(),n&&n()})},n.prototype.show=function(){return this.element.display="",this},n.prototype.hide=function(){return this.element.display="none",this},n.prototype.size=function(t,e){if("100%"===t&&"100%"===e)return this.maximize();this.preMaximize&&this.restore();var n=this.element;return n.style.width=t,n.style.height=e,this},n.prototype.dock=function(t){t=t||"bottom right";var e=t.indexOf("left")>=0,n=t.indexOf("right")>=0,i=t.indexOf("bottom")>=0,o=t.indexOf("top")>=0,r=this.element;r.style.position="fixed",r.style.left=e?0:"auto",r.style.right=n?0:"auto",r.style.bottom=i?0:"auto",r.style.top=o?0:"auto",r.style.margin=0,r.style.padding=0,r.style.border=0,r.style.zIndex=99999999;var s=this.preMaximize;return s&&(r.style.width=s.width,r.style.height=s.height,this.preMaximize=null),this},n.prototype.maximize=function(){var t={},e=this.element;return e.style.position="fixed",t.left=e.style.left,t.right=e.style.right,t.bottom=e.style.bottom,t.top=e.style.top,t.width=e.style.width,t.height=e.style.height,e.style.left=0,e.style.right=0,e.style.bottom=0,e.style.top=0,e.style.width="100%",e.style.height="100%",e.contentWindow.focus(),this.preMaximize||(this.preMaximize=t),this},n.prototype.restore=function(){var t=this.preMaximize;if(t){var e=this.element;for(var n in t)e.style[n]=t[n];return this.preMaximize=null,this}},e.exports=n},{"es6-promise":1}],13:[function(t,e){function n(t,e){if(this.options=e||{},"string"!=typeof t||t.length<1)throw new Error("name must be a non-empty string");this.name=t,this.options=e||{},this.handlers=[],this.listening=!1,this.isReady=!1,this.options.iframe&&(this.iframe=new s(this))}function i(t,e,n,i,o){var r=t.findMyWindow(),s=function(n){if(n.data&&n.data.channel===t.name&&t.originIsAllowed(n.origin)&&n.data._responseTo===e){if(!s)return;r.removeEventListener("message",s),s=null,n.data&&n.data.error?o(new Error(n.data.error)):i(n.data)}};r.addEventListener("message",s,!1),setTimeout(function(){if(s){r.removeEventListener("message",s),s=null;var t=new Error("timeout waiting for cross-frame response");t.timeout=!0,o(t)}},n||t.options.responseTimeout||3e3)}function o(t,e,n){var i;e.respond&&(i=function(n){var i=n;i instanceof Error&&(i={error:i.message}),"object"!=typeof i&&(i={value:i}),i._responseTo=e._messageid,t.push(i)});try{n(e,i)}catch(o){console&&console.error&&(console.error("error on subscriber: ",o),console.error(o.stack))}}var r=t("es6-promise").Promise,s=t("./channel-iframe"),a=0;n.prototype.findMyWindow=function(){if(this._myWindow)return this._myWindow;var t=this.options.myWindow;return t&&"function"==typeof t.addEventListener?(this._myWindow=t,this._myWindow):(this._myWindow=window,this._myWindow)},n.prototype.findWindow=function(){if(this._window)return this._window;var t=this.options.target;if(!t&&this.options.iframe&&this.options.iframe.id&&(t="#"+this.options.iframe.id),"string"==typeof t){var e=document.querySelector(t);if(!e||!e.contentWindow)throw new Error("unable to find contentWindow of "+t);return this._window=e.contentWindow,this._window}if(t&&"function"==typeof t.postMessage)return this._window=t,this._window;throw new Error("no valid target was provided (eg. #iframeIdOrSelector, window.parent, someWindow)")},n.prototype.push=function(t){var e=t;"object"!=typeof e&&(e={value:e}),e.channel=this.name,a++;var n=e._messageid=a,o=this.findWindow(),s=this;return setTimeout(function(){o.postMessage(e,s.options.targetOrigin||"*")},1),new r(function(t,o){return e.respond?void i(s,n,e.timeout,t,o):void t()})},n.prototype.request=function(t){var e=t;return"object"!=typeof e&&(e={value:e}),e.respond=!0,this.push(e)},n.prototype.originIsAllowed=function(t){var e=this.options.originFilter;return e?"function"==typeof e.test?e.test(event.origin):"string"==typeof e?t===e:!1:!0},n.prototype.subscribe=function(t){if("function"!=typeof t)throw new Error("handler function is required");if(this.handlers.push(t),!this.listening){var e=this,n=e.findMyWindow();n.addEventListener("message",function(t){if(t.data&&t.data.channel===e.name&&e.originIsAllowed(t.origin))for(var n=Array.prototype.slice.apply(e.handlers);n.length;)o(e,t.data,n.shift())},!1),this.listening=!0,this.respondToPings(),this.options.autoReady!==!1&&this.notifyReady()}return this},n.prototype.respondToPings=function(){this.respondingToPings||this.subscribe(function(t,e){t.ping&&e&&e({pong:!0})})},n.prototype.notifyReady=function(){this.respondToPings();try{this.push({ready:!0})}catch(t){}},n.prototype.unsubscribe=function(t){for(var e=this.handlers.length-1;e>=0;e--)this.handlers[e]===t&&this.handlers.splice(e,1);return this},e.exports=n},{"./channel-iframe":12,"es6-promise":1}],14:[function(t,e,n){(function(e){var i=t("./channel");n.Channel=i,n.create=function(t,e){return new i(t,e)};var o="undefined"!=typeof e&&"string"==typeof e.execPath;if(o){var r=t("../package.json");n.version=r.version,n.homepage=r.homepage}else n.homepage="https://github.com/benjamine/frame-channels",n.version="0.0.31"}).call(this,t("1YiZ5S"))},{"./channel":13,"1YiZ5S":11}]},{},[14])(14)});